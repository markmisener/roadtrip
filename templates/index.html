<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title></title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.2/mapbox-gl-directions.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.2/mapbox-gl-directions.css" type="text/css" />
  <script src='https://npmcdn.com/csv2geojson@latest/csv2geojson.js'></script>
  <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
  <script src="static/js/mapping.js"></script>
  <link href='static/style.css' rel='stylesheet' />
</head>

<body>

  <div id='map'></div>
  <script>

    var baseUrl = 'https://api.mapbox.com/directions/v5/mapbox/driving'

    mapboxgl.accessToken = '{{ MAPBOX_ACCESS_TOKEN }}';

    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [-94.22119806296678, 38.82337408526456],
      zoom: 4,
    });

    var pointData = {{ data | tojson | safe }};
    addPointDataToMap(map, pointData);

    var pointsString = formatPointData(pointData);
    var requestUrl = `${baseUrl}/${pointsString}.json?access_token=${mapboxgl.accessToken}&geometries=geojson&overview=full`
    let loadRouteData = async () => requestData(requestUrl);
    loadRouteData().then((data) => addRouteDataToMap(map, data.routes[0].geometry))

  </script>

</body>

</html>
